/*
 * jQuery Booklet Plugin
 * Copyright (c) 2010 - 2014 William Grauvogel (http://builtbywill.com/)
 *
 * Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php)
 *
 * Version : 2.0.0
 *
 */
(function(e){function o(e){return'<div class="'+e+'"></div>'}function u(e){return typeof e!=="undefined"}function a(e){return u(e)&&e!=null}function f(e){return typeof e==="string"}function l(e){return typeof e==="number"}function c(e){return typeof e==="object"}function h(e,t){this.index=t;this.contentNode=e;this.isTransparent=this.contentNode.hasClass("b-page-transparent");this.isBlank=this.contentNode.hasClass("b-page-blank");this.pageNode=this.createPageNode()}function p(u,p){var d=u,v,m=[],g,y,b,w,E,S,x=e.extend({},e.fn.booklet.defaults,p),T=false,N=false,C=false,k=false,L=false,A=false,O,M,_,D,P,H,B,j,F,I,q,R,U=function(){d.addClass("booklet");d.data("booklet",this);M=d.children().length;D=0;dt();ct();gt();ht();T=true;L=false;if(x.create){d.off(i.create+s).on(i.create+s,x.create)}d.trigger(i.create,{options:e.extend({},x),index:D,pages:[m[D],m[D+1]]})},z=function(){L=false},W=function(){L=true},X=function(){Nt();pt();Et();d.removeClass("booklet");d.removeData("booklet");T=false},V=function(){return x.direction==r.leftToRight},J=function(){return D==0},K=function(){return D>=_-2},Q=function(){return D-2>=0},G=function(){return D+2<=_-2},Y=function(e){return f(e)&&e.indexOf("px")!=-1},Z=function(e){return e.replace("px","")},et=function(e){return f(e)&&e.indexOf("%")!=-1},tt=function(e,t){return e.replace("%","")/100*parseFloat(t)},nt=function(){return a(B)||a(j)},rt=function(){return x.width/2},it=function(){return rt()/2},st=function(){return"-"+rt()+"px"},ot=function(){return"-"+it()+"px"},ut=function(){return x.height},at=function(){return{width:rt(),height:ut()}},ft=function(){return[F,q,I,R]},lt=function(){e(d.children().get().reverse()).each(function(){e(this).appendTo(d)})},ct=function(){m=[];if(x.single){d.children().each(function(n){if(!x.closed||n!=0){if(V()){e(this).before(o(t.page.blank))}else{e(this).after(o(t.page.blank))}}})}if(d.children().length%2!=0){d.children().last().after(o(t.page.blank))}if(x.closed){d.prepend(o(t.page.transparent));d.append(o(t.page.transparent))}_=d.children().length;if(!V()){lt()}if(!T){D=V()?0:_-2;if(!isNaN(x.startingIndex)&&x.startingIndex<=_&&x.startingIndex>0){if(x.startingIndex%2!=0){x.startingIndex--}D=x.startingIndex}}d.children().each(function(t){var n=new h(e(this),t);m.push(n)})},ht=function(){mt();if(Q()){g=m[D-2].pageNode;y=m[D-1].pageNode}b=m[D].pageNode;w=m[D+1].pageNode;if(G()){E=m[D+2].pageNode;S=m[D+3].pageNode}e.each(m,function(){this.pageNode.css(n.page)});if(g)g.css(n.pageOuter);if(y)y.css(n.pageInner);b.css(n.pageVisible);w.css(n.pageVisible);if(E)E.css(n.pageInner);if(S)S.css(n.pageOuter)},pt=function(){e.each(m,function(){this.destroy()});m=[];mt();if(!V()){lt()}},dt=function(){F=e(o(t.shadow));q=e(o(t.shadow));I=e(o(t.shadow));R=e(o(t.shadow))},vt=function(e){if(e&&F.parent()!=E||!e&&F.parent()!=b){F.css({opacity:0}).appendTo(e?E:b)}if(e&&I.parent()!=w||!e&&I.parent()!=y){I.css({opacity:0}).appendTo(e?w:y)}if(e&&q.parent()!=b||!e&&q.parent()!=g){q.css({opacity:0}).appendTo(e?b:g)}if(e&&R.parent()!=S||!e&&R.parent()!=w){R.css({opacity:0}).appendTo(e?S:w)}},mt=function(){e.each(ft(),function(){this.remove()})},gt=function(t){var n=false;if(a(t)){pt();x=e.extend({},x,t);n=true;ct()}yt();if(!x.autoCenter&&!x.single){Et()}else{wt();bt()}Nt();Tt();if(n){ht()}},yt=function(){if(!x.width){x.width=d.width()}else if(Y(x.width)){x.width=Z(x.width)}else if(et(x.width)){B=x.width;x.width=tt(B,d.parent().width())}if(!x.height){x.height=d.height()}else if(Y(x.height)){x.height=Z(x.height)}else if(et(x.height)){j=x.height;x.height=tt(j,d.parent().height())}d.width(x.width);d.height(x.height);xt()},bt=function(){if(x.closed&&x.autoCenter||x.single){if(v){v.width(x.width);v.height(x.height);if(x.single){v.width(rt());d.css({marginLeft:st()})}else if(J()){d.css({marginLeft:ot()})}else if(K()){d.css({marginLeft:it()})}}else{d.css({marginLeft:0})}}},wt=function(){if(x.closed&&x.autoCenter||x.single){if(d.parent().hasClass("b-wrapper")){v=d.parent()}else{v=d.wrap(o(t.wrapper)).parent()}}},Et=function(){if(d.parent().hasClass("b-wrapper")){d.unwrap();v=null}},St=function(){if(!L){if(a(B)){x.width=tt(B,d.parent().width());d.width(x.width)}if(a(j)){x.height=tt(j,d.parent().height());d.height(x.height)}xt()}},xt=function(){e.each(m,function(){this.pageNode.css(at())});e.each(ft(),function(){this.css(at())})},Tt=function(){e(document).on("keyup"+s,function(e){if(e.keyCode==37&&x.keyboard){Dt()}else if(e.keyCode==39&&x.keyboard){_t()}});e(window).on("resize"+s,function(){if(nt){St()}});if(x.hovers){d.on("mousemove"+s,function(e){O=e.pageX-d.offset().left;if(x.overlays){if(O<rt()&&!J()){if(C)Ot(true);At(false)}else if(O>rt&&!K()){if(k)Ot(false);At(true)}else{Mt()}}else{if(O<x.hoverWidth){At(false)}else if(O>x.width-x.hoverWidth){At(true)}else{Mt()}}}).on("mouseleave"+s,function(){Mt()})}if(x.overlays||x.hovers){d.on("click"+s,function(e){O=e.pageX-d.offset().left;if(O<rt()&&!J()){if(x.overlays)e.preventDefault();Dt()}else if(O>rt()&&!K()){if(x.overlays)e.preventDefault();_t()}})}},Nt=function(){e(document).off("keyup"+s);e(window).off("resize"+s);d.off(s)},Ct=function(e){if(!a(e))return false;return!(l(e)&&(e<0||e>M))},kt=function(t,n){if(!Ct(t))return;if(!a(n)||n=="")return;t=t=="start"?0:t=="end"?M:t;pt();Nt();if(t==M){d.children(":eq("+(t-1)+")").after(n)}else{d.children(":eq("+t+")").before(n)}M=d.children().length;if(x.add){d.off(i.add+s).on(i.add+s,x.add)}d.trigger(i.add,{options:e.extend({},x),index:t,page:d.children(":eq("+t+")")[0]});ct();gt();ht()},Lt=function(t){if(!Ct(t))return;t=t=="start"?0:t=="end"?M:t;if(d.children(".b-page").length==2&&d.find(".b-page-blank").length>0){return}pt();Nt();if(t>=D){if(t>0&&t%2!=0){D-=2}if(D<0){D=0}}var n;if(t==M){n=d.children(":eq("+(t-1)+")").remove()}else{n=d.children(":eq("+t+")").remove()}M=d.children().length;if(x.remove){d.off(i.remove+s).on(i.remove+s,x.remove)}d.trigger(i.remove,{options:e.extend({},x),index:t,page:n[0]});n=null;ct();gt();ht()},At=function(e){if(!L&&(x.hovers||x.manual)){if(e){if(!N&&!C&&!P&&G()){S.css({visibility:"visible"});w.stop().transition({rotateY:"-10deg"},x.hoverSpeed,x.easing);jt(e,x.hoverSpeed,.1);C=true}}else{if(!N&&!k&&!H&&Q()){g.css({visibility:"visible"});b.stop().transition({rotateY:"10deg"},x.hoverSpeed,x.easing);jt(e,x.hoverSpeed,.1);k=true}}}},Ot=function(e){if(!L&&(x.hovers||x.manual)){if(e){if(!N&&C&&!P&&G()){S.css({visibility:"hidden"});w.stop().transition({rotateY:"0deg"},x.hoverSpeed,x.easing);jt(e,x.hoverSpeed,0);C=false}}else{if(!N&&k&&!H&&Q()){g.css({visibility:"hidden"});b.stop().transition({rotateY:"0deg"},x.hoverSpeed,x.easing);jt(e,x.hoverSpeed,0);k=false}}}},Mt=function(){Ot(false);Ot(true)},_t=function(){if(!N&&!L){Pt(D+2)}},Dt=function(){if(!N&&!L){Pt(D-2)}},Pt=function(t){var n=x.speed;if(t<_&&t>=0&&!N&&!L){if(t>D){N=true;O=t-D;D=t;A=true}else if(t<D){N=true;O=D-t;D=t;A=false}if(x.willchange){d.off(i.willchange+s).on(i.willchange+s,x.willchange)}d.trigger(i.willchange,{options:e.extend({},x),index:t,pages:[m[t].contentNode,m[t+1].contentNode]});Ht(O,A);Bt(O,A,n);jt(A,n,1)}},Ht=function(e,t){if(t&&e>2){E.hide();S.hide();E=m[D].pageNode.css(n.pageInner).show();S=m[D+1].pageNode.css(n.pageOuter).show()}else if(!t&&e>2){g.hide();y.hide();g=m[D].pageNode.css(n.pageOuter).show();y=m[D+1].pageNode.css(n.pageInner).show()}},Bt=function(t,n,r){if(x.startchange){d.off(i.startchange+s).on(i.startchange+s,x.startchange)}d.trigger(i.startchange,{options:e.extend({},x),index:D,pages:[m[D].contentNode,m[D+1].contentNode]});if(n){S.css({visibility:"visible"});if(!x.single){if(v&&D-t==0){d.transition({marginLeft:0},r,x.easing)}else if(v&&K()){d.transition({marginLeft:it()},r,x.easing)}}w.transition({rotateY:"-90deg"},r/2,x.easeIn,function(){w.transition({visibility:"hidden"},0);E.transition({visibility:"visible"},0).transition({rotateY:"0deg"},r/2,x.easeOut,Ft)});E.transition({rotateY:"90deg"},r/2,x.easeIn)}else{g.css({visibility:"visible"});if(!x.single){if(v&&J()){d.transition({marginLeft:ot()},r,x.easing)}else if(v&&D+t>=_-2){d.transition({marginLeft:0},r,x.easing)}}b.transition({rotateY:"90deg"},r/2,x.easeIn,function(){b.transition({visibility:"hidden"},0).transition({rotateY:"180deg"},r/2,x.easeOut);y.transition({visibility:"visible"},0).transition({rotateY:"0deg"},r/2,x.easeOut,Ft)});y.transition({rotateY:"-90deg"},r/2,x.easeIn)}},jt=function(e,t,n){if(x.shadows){vt(e);var r=e?F:I,i=e?q:R,s=e?I:F,o=e?R:q;r.css({opacity:n});o.css({opacity:n});o.stop().animate({opacity:0},t,x.easing);s.stop().animate({opacity:n},t/2,x.easeIn,function(){r.stop().animate({opacity:0},t/2,x.easeOut)});i.stop().animate({opacity:n},t,x.easing,function(){if(n==0){mt()}})}},Ft=function(){ht();N=false;if(x.didchange){d.off(i.didchange+s).on(i.didchange+s,x.didchange)}d.trigger(i.didchange,{options:e.extend({},x),index:D,pages:[m[D].contentNode,m[D+1].contentNode]})};return{init:U,enable:z,disable:W,destroy:X,next:_t,prev:Dt,gotopage:function(e){if(f(e)){if(e=="start"){e=0}else if(e=="end"){e=_-2}else{this.gotopage(parseInt(e))}}else if(l(e)){if(e<0||e>=_){return}}else if(!a(e)){return}if(e%2!=0){e-=1}if(!V()){e=Math.abs(e-_)-2}Pt(e)},add:kt,remove:Lt,option:function(t,n){if(f(t)){if(!a(x[t]))e.error('Option "'+t+'" does not exist on jQuery.booklet.');if(a(n)){x[t]=n;gt();return n}return x[t]}if(c(t)){gt(t);return e.extend({},x)}return e.extend({},x)}}}var t={booklet:"booklet",page:{"default":"b-page",blank:"b-page b-page-blank",cover:"b-page b-page-cover",transparent:"b-page b-page-transparent"},shadow:"b-shadow",wrapper:"b-wrapper"},n={page:{visibility:"hidden",zIndex:10},pageOuter:{zIndex:10},pageInner:{zIndex:30},pageVisible:{visibility:"visible",zIndex:20}},r={leftToRight:"LTR",rightToLeft:"RTL"},i={create:"bookletcreate",willchange:"bookletwillchange",startchange:"bookletstartchange",didchange:"bookletdidchange",add:"bookletadd",remove:"bookletremove"},s=".booklet";e.fn.booklet=function(t,n,r){var i,s,o,a;if(f(t)){a=[];s=[];if(u(n)){s.push(n)}if(u(r)){s.push(r)}e(this).each(function(){i=e(this).data("booklet");if(!i)e.error('jQuery.booklet has not been initialized. Method "'+t+'" cannot be called.');if(!i[t])e.error('Method "'+t+'" does not exist on jQuery.booklet.');o=i[t].apply(i,s);if(u(o)||o){a.push(o)}});if(a.length==1){return a[0]}if(a.length>0){return a}return e(this)}return e(this).each(function(){i=e(this).data("booklet");if(i){i.destroy()}i=new p(e(this),t);i.init();return this})};e.fn.booklet.defaults={width:600,height:400,speed:500,direction:"LTR",startingIndex:0,easing:"easeInOutQuad",easeIn:"easeInQuad",easeOut:"easeOutQuad",single:false,closed:false,autoCenter:false,manual:true,hovers:true,hoverWidth:50,hoverSpeed:500,hoverThreshold:.25,hoverClick:true,overlays:false,keyboard:true,shadows:true,create:null,willchange:null,startchange:null,didchange:null,add:null,remove:null};h.prototype={constructor:h,createPageNode:function(){if(this.isBlank||this.isTransparent){return this.contentNode}else{return this.contentNode.wrap(o(t.page.default)).parent()}},destroy:function(){if(this.isBlank||this.isTransparent)this.pageNode.remove();else this.contentNode.unwrap()}}})(jQuery)