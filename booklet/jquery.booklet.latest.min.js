/*
 * jQuery Booklet Plugin
 * Copyright (c) 2010 - 2014 William Grauvogel (http://builtbywill.com/)
 *
 * Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php)
 *
 * Version : 2.0.0
 *
 */
(function(e){function N(e){return'<div class="'+e+'"></div>'}function C(e){return typeof e!=="undefined"}function k(e){return C(e)&&e!=null}function L(e){return typeof e==="string"}function A(e){return typeof e==="number"}function O(e){return typeof e==="object"}function M(e){return L(e)&&e.indexOf("px")!=-1}function _(e){return e.replace("px","")}function D(e){return L(e)&&e.indexOf("%")!=-1}function P(e,t){return e.replace("%","")/100*parseFloat(t)}function H(e){return"-"+e+"px"}function B(e){return e+"deg"}function j(e){return"-"+B(e)}function F(e,t){this.index=t;this.contentNode=e;this.isTransparent=this.contentNode.hasClass(f);this.isBlank=this.contentNode.hasClass(a);this.pageNode=this.createPageNode();this.pageNode.attr("style",t%2==0?p:d)}function I(t,n){var r=t,i=e.extend({},e.fn.booklet.defaults,n),s,p=[],d,C,I,q,R,U,z=false,W=false,X=false,V=false,J=false,K=false,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at=function(){return{target:r,wrapper:s,options:e.extend({},i),pages:p,pageTotal:Y,originalPageTotal:G,currentIndex:Z,created:z,busy:W,hoveringRight:X,hoveringLeft:V,enabled:J,movingForward:K}},ft=function(e,t,n,i){n=n||Z;i=i||[p[Z],p[Z+1]];r.off(e+T);if(typeof t==="function"){r.on(e+T,t)}r.trigger(e,{info:at(),index:n,pages:i})},lt=function(){return i.leftToRight},ct=function(){return Z==0},ht=function(){return Z>=Y-2},pt=function(){return Z-2>=0},dt=function(){return Z+2<=Y-2},vt=function(){return k(nt)||k(rt)},mt=function(){return i.width/2},gt=function(){return mt()/2},yt=function(){return H(mt())},bt=function(){return H(gt())},wt=function(){return i.height},Et=function(){return{width:mt(),height:wt()}},St=function(){return[it,ot,st,ut]},xt=function(){e(r.children().get().reverse()).each(function(){e(this).appendTo(r)})},Tt=function(e){if(!k(e))return false;return!(A(e)&&(e<0||e>G))},Nt=function(){r.addClass(o).attr("style",h);r.data("booklet",this);G=r.children().length;Z=0;_t();At();jt();Ot();z=true;J=true;ft(y,i.create)},Ct=function(){J=true},kt=function(){J=false},Lt=function(){zt();Mt();Bt();r.removeClass(o).style("");r.removeData("booklet");z=false},At=function(){p=[];if(i.single){r.children().each(function(t){if(!i.closed||t!=0){if(lt()){e(this).before(N(u+" "+a))}else{e(this).after(N(u+" "+a))}}})}if(r.children().length%2!=0){r.children().last().after(N(u+" "+a))}if(i.closed){r.prepend(N(u+" "+f));r.append(N(u+" "+f))}Y=r.children().length;if(!lt()){xt()}if(!z){Z=lt()?0:Y-2;if(!isNaN(i.startingIndex)&&i.startingIndex<=Y&&i.startingIndex>0){if(i.startingIndex%2!=0){i.startingIndex--}Z=i.startingIndex}}r.children().each(function(t){var n=new F(e(this),t);p.push(n)})},Ot=function(){Pt();if(pt()){d=p[Z-2].pageNode;C=p[Z-1].pageNode}I=p[Z].pageNode;q=p[Z+1].pageNode;if(dt()){R=p[Z+2].pageNode;U=p[Z+3].pageNode}e.each(p,function(){this.pageNode.css(g.page)});if(d)d.css(g.pageOuter);if(C)C.css(g.pageInner);I.css(g.pageVisible);q.css(g.pageVisible);if(R)R.css(g.pageInner);if(U)U.css(g.pageOuter)},Mt=function(){Pt();e.each(p,function(){this.destroy()});p=[];if(!lt()){xt()}},_t=function(){it=e(N(l)).attr("style",v);ot=e(N(l)).attr("style",v);st=e(N(l)).attr("style",m);ut=e(N(l)).attr("style",m)},Dt=function(e){if(e&&it.parent()!=R||!e&&it.parent()!=I){it.css({opacity:0}).appendTo(e?R:I)}if(e&&st.parent()!=q||!e&&st.parent()!=C){st.css({opacity:0}).appendTo(e?q:C)}if(e&&ot.parent()!=I||!e&&ot.parent()!=d){ot.css({opacity:0}).appendTo(e?I:d)}if(e&&ut.parent()!=U||!e&&ut.parent()!=q){ut.css({opacity:0}).appendTo(e?U:q)}},Pt=function(){e.each(St(),function(){this.remove()})},Ht=function(){if(r.parent().hasClass(c)){s=r.parent()}else{s=r.wrap(N(c)).parent()}},Bt=function(){if(r.parent().hasClass(c)){r.unwrap();s=null}},jt=function(t){var n=false;if(k(t)){Mt();i=e.extend({},i,t);n=true;At()}Ft();if(!i.autoCenter&&!i.single&&!i.single){Bt()}else{Ht();Rt()}zt();Ut();if(n){Ot()}},Ft=function(){if(!i.width){i.width=r.width()}else if(M(i.width)){i.width=_(i.width)}else if(D(i.width)){nt=i.width;i.width=P(nt,r.parent().width())}if(!i.height){i.height=r.height()}else if(M(i.height)){i.height=_(i.height)}else if(D(i.height)){rt=i.height;i.height=P(rt,r.parent().height())}r.width(i.width);r.height(i.height);qt()},It=function(){if(k(nt)){i.width=P(nt,r.parent().width());r.width(i.width)}if(k(rt)){i.height=P(rt,r.parent().height());r.height(i.height)}qt()},qt=function(){e.each(p,function(){this.pageNode.css(Et())});e.each(St(),function(){this.css(Et())})},Rt=function(){if(i.closed&&i.autoCenter||i.single){if(s){s.width(i.width);s.height(i.height);if(i.single){s.width(mt());r.css({marginLeft:yt()})}else if(ct()){r.css({marginLeft:bt()})}else if(ht()){r.css({marginLeft:gt()})}}else{r.css({marginLeft:0})}}},Ut=function(){e(document).on("keyup"+T,function(e){if(e.keyCode==37&&i.keyboard){Xt()}else if(e.keyCode==39&&i.keyboard){Wt()}});e(window).on("resize"+T,function(){if(vt){It()}});if(i.hovers){r.on("mousemove"+T,function(e){Q=e.pageX-r.offset().left;if(i.overlays){if(Q<mt()&&!ct()){if(X)Yt(true);Gt(false)}else if(Q>mt&&!ht()){if(V)Yt(false);Gt(true)}else{Zt()}}else{if(Q<i.hoverWidth){Gt(false)}else if(Q>i.width-i.hoverWidth){Gt(true)}else{Zt()}}}).on("mouseleave"+T,function(){Zt()})}if(i.overlays||i.hovers){r.on("click"+T,function(e){Q=e.pageX-r.offset().left;if(Q<mt()&&!ct()){if(i.overlays)e.preventDefault();Xt()}else if(Q>mt()&&!ht()){if(i.overlays)e.preventDefault();Wt()}})}},zt=function(){e(document).off("keyup"+T);e(window).off("resize"+T);r.off(T)},Wt=function(){if(!W&&J){Vt(Z+2)}},Xt=function(){if(!W&&J){Vt(Z-2)}},Vt=function(e){if(e!=Z&&e>=0&&e<Y&&!W&&J){ft(b,i.willchange);W=true;K=e>Z;Q=K?e-Z:Z-e;Z=e;$t(Q,K);Jt(Q,K,i.speed);Qt(K,i.speed,1)}},$t=function(e,t){if(t&&e>2){R.hide();U.hide();R=p[Z].pageNode.css(g.pageInner).show();U=p[Z+1].pageNode.css(g.pageOuter).show()}else if(!t&&e>2){d.hide();C.hide();d=p[Z].pageNode.css(g.pageOuter).show();C=p[Z+1].pageNode.css(g.pageInner).show()}},Jt=function(e,t,n){ft(w,i.startchange);if(!i.single&&s){if(t&&Z-e==0||!t&&Z+e>=Y-2){r.transition({marginLeft:0},n,i.easing)}else if(t&&ht()){r.transition({marginLeft:gt()},n,i.easing)}else if(!t&&ct()){r.transition({marginLeft:bt()},n,i.easing)}}var o=t?q:I,u=t?R:C,a=t?U:d;if(a)a.css({visibility:"visible"});o.transition({rotateY:t?j(90):B(90)},n/2,i.easeIn,function(){o.transition({visibility:"hidden"},0);u.transition({visibility:"visible"},0).transition({rotateY:B(0)},n/2,i.easeOut,Kt)});u.transition({rotateY:t?B(90):j(90)},n/2,i.easeIn)},Kt=function(){Ot();W=false;ft(E,i.didchange)},Qt=function(e,t,n){if(i.shadows){Dt(e);var r=e?it:st,s=e?ot:ut,o=e?st:it,u=e?ut:ot;r.css({opacity:n});u.css({opacity:n});u.stop().transition({opacity:0},t,i.easing);o.stop().transition({opacity:n},t/2,i.easeIn,function(){r.stop().transition({opacity:0},t/2,i.easeOut)});s.stop().transition({opacity:n},t,i.easing,function(){if(n==0)Pt()})}},Gt=function(e){if(!J&&(i.hovers||i.manual)){if(e){if(!W&&!X&&!et&&dt()){U.css({visibility:"visible"});q.stop().transition({rotateY:"-10deg"},i.hoverSpeed,i.easing);Qt(e,i.hoverSpeed,.1);X=true}}else{if(!W&&!V&&!tt&&pt()){d.css({visibility:"visible"});I.stop().transition({rotateY:"10deg"},i.hoverSpeed,i.easing);Qt(e,i.hoverSpeed,.1);V=true}}}},Yt=function(e){if(J&&(i.hovers||i.manual)){if(e){if(!W&&X&&!et&&dt()){U.css({visibility:"hidden"});q.stop().transition({rotateY:"0deg"},i.hoverSpeed,i.easing,function(){X=false});Qt(e,i.hoverSpeed,0)}}else{if(!W&&V&&!tt&&pt()){d.css({visibility:"hidden"});I.stop().transition({rotateY:"0deg"},i.hoverSpeed,i.easing,function(){V=false});Qt(e,i.hoverSpeed,0)}}}},Zt=function(){Yt(false);Yt(true)},en=function(e){return e=="start"?0:e=="end"?G:e},tn=function(e,t){if(!Tt(e))return;if(!k(t)||t=="")return;e=en(e);Mt();zt();if(e==G){r.children(":eq("+(e-1)+")").after(t)}else{r.children(":eq("+e+")").before(t)}ft(S,i.add,e,r.children(":eq("+e+")")[0]);G=r.children().length;At();jt();Ot()},nn=function(e){if(!Tt(e))return;e=en(e);if(r.children(u).not(f).length==2)return;Mt();zt();var t=r.children(":eq("+(e==G?e-1:e)+")").remove();ft(x,i.remove,e,t[0]);t=null;if(e>=Z){if(e>0&&e%2!=0){Z-=2}if(Z<0){Z=0}}G=r.children().length;At();jt();Ot()};this.info=at;this.init=Nt;this.enable=Ct;this.disable=kt;this.destroy=Lt;this.next=Wt;this.prev=Xt;this.gotopage=function(t){if(!k(t)){e.error("jquery.booklet:gotopage: index must not be undefined or null");return}if(A(t)&&t<0||t>=Y){e.error("jquery.booklet:gotopage: index is out of bounds");return}if(L(t)){t=t=="start"?0:t=="end"?Y-2:parseInt(t);if(isNaN(t)){e.error("jquery.booklet:gotopage: index parseInt failed");return}}if(t%2!=0){t-=1}if(!lt()){t=Math.abs(t-Y)-2}Vt(t)};this.add=tn;this.remove=nn;this.option=function(t,n){if(L(t)){if(!k(i[t]))e.error('jquery.booklet:option: option "'+t+'" does not exist');if(k(n)){i[t]=n;jt();return n}return i[t]}if(O(t)){jt(t)}return e.extend({},i)};this.init()}var t=window.getComputedStyle(document.documentElement,""),n=(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||t.OLink===""&&["","o"])[1],r="WebKit|Moz|MS|O".match(new RegExp("("+n+")","i"))[1],i={dom:r,lowercase:n,css:"-"+n+"-",js:n[0].toUpperCase()+n.substr(1)},s=function(e){return i.css+e},o="booklet",u="b-page",a=u+"-blank",f=u+"-transparent",l="b-shadow",c="b-wrapper",h=s("perspective")+":2000px; "+s("perspective-origin")+":50% 50%; "+s("transform-style")+":preserve-3d; "+s("backface-visibility")+":hidden;",p=s("transform-origin")+":100% 0; background-image:"+s("linear-gradient")+"(left, #fff 50%, #fafafa 95%, #f5f5f5);",d="left:50%; "+s("transform-origin")+":0 0; background-image:"+s("linear-gradient")+"(right, #fff 50%, #fafafa 95%, #f5f5f5);",v="background-image:"+s("radial-gradient")+"(right, circle, rgba(0,0,0,0.25) 10%, rgba(0,0,0,0) 70%)",m="background-image:"+s("radial-gradient")+"(left, circle, rgba(0,0,0,0.25) 10%, rgba(0,0,0,0) 70%)",g={page:{visibility:"hidden",zIndex:10},pageOuter:{zIndex:10},pageInner:{zIndex:30},pageVisible:{visibility:"visible",zIndex:20}},y="bookletcreate",b="bookletwillchange",w="bookletstartchange",E="bookletdidchange",S="bookletadd",x="bookletremove",T=".booklet";e.fn.booklet=function(t,n,r){var i,s,o,u;if(L(t)){u=[];s=[];if(C(n)){s.push(n)}if(C(r)){s.push(r)}e(this).each(function(){i=e(this).data("booklet");if(!i)e.error('jquery.booklet has not been initialized. Method "'+t+'" cannot be called.');if(!i[t])e.error('jquery.booklet: method "'+t+'" does not exist.');o=i[t].apply(i,s);if(C(o)||o){u.push(o)}});if(u.length==1){return u[0]}if(u.length>0){return u}return e(this)}return e(this).each(function(){i=e(this).data("booklet");if(i){i.destroy()}i=new I(e(this),t);return this})};e.fn.booklet.defaults={width:600,height:400,speed:500,leftToRight:true,startingIndex:0,easing:"easeInOutQuad",easeIn:"easeInQuad",easeOut:"easeOutQuad",single:false,closed:false,autoCenter:false,manual:true,hovers:true,hoverWidth:50,hoverSpeed:500,hoverThreshold:.25,hoverClick:true,overlays:false,keyboard:true,shadows:true,create:null,willchange:null,startchange:null,didchange:null,add:null,remove:null};F.prototype={constructor:F,createPageNode:function(){if(this.isBlank||this.isTransparent){return this.contentNode}else{return this.contentNode.wrap(N(u)).parent()}},destroy:function(){if(this.isBlank||this.isTransparent)this.pageNode.remove();else this.contentNode.unwrap()}};I.prototype={constructor:I}})(jQuery)