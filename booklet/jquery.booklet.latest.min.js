/*
 * jQuery Booklet Plugin
 * Copyright (c) 2010 - 2014 William Grauvogel (http://builtbywill.com/)
 *
 * Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php)
 *
 * Version : 2.0.0
 *
 */
(function(e){function o(e){return'<div class="'+e+'"></div>'}function u(e){return typeof e!=="undefined"}function a(e){return u(e)&&e!=null}function f(e){return typeof e==="string"}function l(e){return typeof e==="number"}function c(e){return typeof e==="object"}function h(e){return f(e)&&e.indexOf("px")!=-1}function p(e){return e.replace("px","")}function d(e){return f(e)&&e.indexOf("%")!=-1}function v(e,t){return e.replace("%","")/100*parseFloat(t)}function m(e){return"-"+e+"px"}function g(e){return e+"deg"}function y(e){return"-"+g(e)}function b(e,n){this.index=n;this.contentNode=e;this.isTransparent=this.contentNode.hasClass(t.page.transparent);this.isBlank=this.contentNode.hasClass(t.page.blank);this.pageNode=this.createPageNode()}function w(u,w){var E=this,S=u,x=e.extend({},e.fn.booklet.defaults,w),T,N=[],C,k,L,A,O,M,_=false,D=false,P=false,H=false,B=false,j=false,F,I,q,R,U,z,W,X,V,J,K,Q,G=function(){return{target:S,wrapper:T,options:e.extend({},x),pages:N,pageTotal:q,originalPageTotal:I,currentIndex:R,created:_,busy:D,hoveringRight:P,hoveringLeft:H,enabled:B,movingForward:j}},Y=function(e,t,n,r){n=n||R;r=r||[N[R],N[R+1]];S.off(e+s);if(typeof t==="function"){S.on(e+s,t)}S.trigger(e,{info:G(),index:n,pages:r})},Z=function(){return x.direction==r.leftToRight},et=function(){return R==0},tt=function(){return R>=q-2},nt=function(){return R-2>=0},rt=function(){return R+2<=q-2},it=function(){return a(W)||a(X)},st=function(){return x.width/2},ot=function(){return st()/2},ut=function(){return m(st())},at=function(){return m(ot())},ft=function(){return x.height},lt=function(){return{width:st(),height:ft()}},ct=function(){return[V,K,J,Q]},ht=function(){e(S.children().get().reverse()).each(function(){e(this).appendTo(S)})},pt=function(e){if(!a(e))return false;return!(l(e)&&(e<0||e>I))},dt=function(){S.addClass(t.booklet);S.data("booklet",this);I=S.children().length;R=0;Et();yt();Ct();bt();_=true;B=true;Y(i.create,x.create)},vt=function(){B=true},mt=function(){B=false},gt=function(){_t();wt();Nt();S.removeClass(t.booklet).css({width:"",height:""});S.removeData("booklet");_=false},yt=function(){N=[];if(x.single){S.children().each(function(n){if(!x.closed||n!=0){if(Z()){e(this).before(o(t.page.blank))}else{e(this).after(o(t.page.blank))}}})}if(S.children().length%2!=0){S.children().last().after(o(t.page.blank))}if(x.closed){S.prepend(o(t.page.transparent));S.append(o(t.page.transparent))}q=S.children().length;if(!Z()){ht()}if(!_){R=Z()?0:q-2;if(!isNaN(x.startingIndex)&&x.startingIndex<=q&&x.startingIndex>0){if(x.startingIndex%2!=0){x.startingIndex--}R=x.startingIndex}}S.children().each(function(t){var n=new b(e(this),t);N.push(n)})},bt=function(){xt();if(nt()){C=N[R-2].pageNode;k=N[R-1].pageNode}L=N[R].pageNode;A=N[R+1].pageNode;if(rt()){O=N[R+2].pageNode;M=N[R+3].pageNode}e.each(N,function(){this.pageNode.css(n.page)});if(C)C.css(n.pageOuter);if(k)k.css(n.pageInner);L.css(n.pageVisible);A.css(n.pageVisible);if(O)O.css(n.pageInner);if(M)M.css(n.pageOuter)},wt=function(){xt();e.each(N,function(){this.destroy()});N=[];if(!Z()){ht()}},Et=function(){V=e(o(t.shadow));K=e(o(t.shadow));J=e(o(t.shadow));Q=e(o(t.shadow))},St=function(e){if(e&&V.parent()!=O||!e&&V.parent()!=L){V.css({opacity:0}).appendTo(e?O:L)}if(e&&J.parent()!=A||!e&&J.parent()!=k){J.css({opacity:0}).appendTo(e?A:k)}if(e&&K.parent()!=L||!e&&K.parent()!=C){K.css({opacity:0}).appendTo(e?L:C)}if(e&&Q.parent()!=M||!e&&Q.parent()!=A){Q.css({opacity:0}).appendTo(e?M:A)}},xt=function(){e.each(ct(),function(){this.remove()})},Tt=function(){if(S.parent().hasClass(t.wrapper)){T=S.parent()}else{T=S.wrap(o(t.wrapper)).parent()}},Nt=function(){if(S.parent().hasClass(t.wrapper)){S.unwrap();T=null}},Ct=function(t){var n=false;if(a(t)){wt();x=e.extend({},x,t);n=true;yt()}kt();if(!x.autoCenter&&!x.single&&!x.single){Nt()}else{Tt();Ot()}_t();Mt();if(n){bt()}},kt=function(){if(!x.width){x.width=S.width()}else if(h(x.width)){x.width=p(x.width)}else if(d(x.width)){W=x.width;x.width=v(W,S.parent().width())}if(!x.height){x.height=S.height()}else if(h(x.height)){x.height=p(x.height)}else if(d(x.height)){X=x.height;x.height=v(X,S.parent().height())}S.width(x.width);S.height(x.height);At()},Lt=function(){if(a(W)){x.width=v(W,S.parent().width());S.width(x.width)}if(a(X)){x.height=v(X,S.parent().height());S.height(x.height)}At()},At=function(){e.each(N,function(){this.pageNode.css(lt())});e.each(ct(),function(){this.css(lt())})},Ot=function(){if(x.closed&&x.autoCenter||x.single){if(T){T.width(x.width);T.height(x.height);if(x.single){T.width(st());S.css({marginLeft:ut()})}else if(et()){S.css({marginLeft:at()})}else if(tt()){S.css({marginLeft:ot()})}}else{S.css({marginLeft:0})}}},Mt=function(){e(document).on("keyup"+s,function(e){if(e.keyCode==37&&x.keyboard){Pt()}else if(e.keyCode==39&&x.keyboard){Dt()}});e(window).on("resize"+s,function(){if(it){Lt()}});if(x.hovers){S.on("mousemove"+s,function(e){F=e.pageX-S.offset().left;if(x.overlays){if(F<st()&&!et()){if(P)Rt(true);qt(false)}else if(F>st&&!tt()){if(H)Rt(false);qt(true)}else{Ut()}}else{if(F<x.hoverWidth){qt(false)}else if(F>x.width-x.hoverWidth){qt(true)}else{Ut()}}}).on("mouseleave"+s,function(){Ut()})}if(x.overlays||x.hovers){S.on("click"+s,function(e){F=e.pageX-S.offset().left;if(F<st()&&!et()){if(x.overlays)e.preventDefault();Pt()}else if(F>st()&&!tt()){if(x.overlays)e.preventDefault();Dt()}})}},_t=function(){e(document).off("keyup"+s);e(window).off("resize"+s);S.off(s)},Dt=function(){if(!D&&B){Ht(R+2)}},Pt=function(){if(!D&&B){Ht(R-2)}},Ht=function(e){if(e!=R&&e>=0&&e<q&&!D&&B){Y(i.willchange,x.willchange);D=true;j=e>R;F=j?e-R:R-e;R=e;Bt(F,j);jt(F,j,x.speed);It(j,x.speed,1)}},Bt=function(e,t){if(t&&e>2){O.hide();M.hide();O=N[R].pageNode.css(n.pageInner).show();M=N[R+1].pageNode.css(n.pageOuter).show()}else if(!t&&e>2){C.hide();k.hide();C=N[R].pageNode.css(n.pageOuter).show();k=N[R+1].pageNode.css(n.pageInner).show()}},jt=function(e,t,n){Y(i.startchange,x.startchange);if(!x.single&&T){if(t&&R-e==0||!t&&R+e>=q-2){S.transition({marginLeft:0},n,x.easing)}else if(t&&tt()){S.transition({marginLeft:ot()},n,x.easing)}else if(!t&&et()){S.transition({marginLeft:at()},n,x.easing)}}var r=t?A:L,s=t?O:k,o=t?M:C;if(o)o.css({visibility:"visible"});r.transition({rotateY:t?y(90):g(90)},n/2,x.easeIn,function(){r.transition({visibility:"hidden"},0);s.transition({visibility:"visible"},0).transition({rotateY:g(0)},n/2,x.easeOut,Ft)});s.transition({rotateY:t?g(90):y(90)},n/2,x.easeIn)},Ft=function(){bt();D=false;Y(i.didchange,x.didchange)},It=function(e,t,n){if(x.shadows){St(e);var r=e?V:J,i=e?K:Q,s=e?J:V,o=e?Q:K;r.css({opacity:n});o.css({opacity:n});o.stop().transition({opacity:0},t,x.easing);s.stop().transition({opacity:n},t/2,x.easeIn,function(){r.stop().transition({opacity:0},t/2,x.easeOut)});i.stop().transition({opacity:n},t,x.easing,function(){if(n==0)xt()})}},qt=function(e){if(!B&&(x.hovers||x.manual)){if(e){if(!D&&!P&&!U&&rt()){M.css({visibility:"visible"});A.stop().transition({rotateY:"-10deg"},x.hoverSpeed,x.easing);It(e,x.hoverSpeed,.1);P=true}}else{if(!D&&!H&&!z&&nt()){C.css({visibility:"visible"});L.stop().transition({rotateY:"10deg"},x.hoverSpeed,x.easing);It(e,x.hoverSpeed,.1);H=true}}}},Rt=function(e){if(B&&(x.hovers||x.manual)){if(e){if(!D&&P&&!U&&rt()){M.css({visibility:"hidden"});A.stop().transition({rotateY:"0deg"},x.hoverSpeed,x.easing,function(){P=false});It(e,x.hoverSpeed,0)}}else{if(!D&&H&&!z&&nt()){C.css({visibility:"hidden"});L.stop().transition({rotateY:"0deg"},x.hoverSpeed,x.easing,function(){H=false});It(e,x.hoverSpeed,0)}}}},Ut=function(){Rt(false);Rt(true)},zt=function(e){return e=="start"?0:e=="end"?I:e},Wt=function(e,t){if(!pt(e))return;if(!a(t)||t=="")return;e=zt(e);wt();_t();if(e==I){S.children(":eq("+(e-1)+")").after(t)}else{S.children(":eq("+e+")").before(t)}Y(i.add,x.add,e,S.children(":eq("+e+")")[0]);I=S.children().length;yt();Ct();bt()},Xt=function(e){if(!pt(e))return;e=zt(e);if(S.children(t.page).not(t.page.transparent).length==2)return;wt();_t();var n=S.children(":eq("+(e==I?e-1:e)+")").remove();Y(i.remove,x.remove,e,n[0]);n=null;if(e>=R){if(e>0&&e%2!=0){R-=2}if(R<0){R=0}}I=S.children().length;yt();Ct();bt()};this.info=G;this.init=dt;this.enable=vt;this.disable=mt;this.destroy=gt;this.next=Dt;this.prev=Pt;this.gotopage=function(t){if(!a(t)){e.error("jquery.booklet:gotopage: index must not be undefined or null");return}if(l(t)&&t<0||t>=q){e.error("jquery.booklet:gotopage: index is out of bounds");return}if(f(t)){t=t=="start"?0:t=="end"?q-2:parseInt(t);if(isNaN(t)){e.error("jquery.booklet:gotopage: index parseInt failed");return}}if(t%2!=0){t-=1}if(!Z()){t=Math.abs(t-q)-2}Ht(t)};this.add=Wt;this.remove=Xt;this.option=function(t,n){if(f(t)){if(!a(x[t]))e.error('jquery.booklet:option: option "'+t+'" does not exist');if(a(n)){x[t]=n;Ct();return n}return x[t]}if(c(t)){Ct(t)}return e.extend({},x)};this.init()}var t={booklet:"booklet",page:{"default":"b-page",blank:"b-page b-page-blank",cover:"b-page b-page-cover",transparent:"b-page b-page-transparent"},shadow:"b-shadow",wrapper:"b-wrapper"},n={page:{visibility:"hidden",zIndex:10},pageOuter:{zIndex:10},pageInner:{zIndex:30},pageVisible:{visibility:"visible",zIndex:20}},r={leftToRight:"LTR",rightToLeft:"RTL"},i={create:"bookletcreate",willchange:"bookletwillchange",startchange:"bookletstartchange",didchange:"bookletdidchange",add:"bookletadd",remove:"bookletremove"},s=".booklet";e.fn.booklet=function(t,n,r){var i,s,o,a;if(f(t)){a=[];s=[];if(u(n)){s.push(n)}if(u(r)){s.push(r)}e(this).each(function(){i=e(this).data("booklet");if(!i)e.error('jquery.booklet has not been initialized. Method "'+t+'" cannot be called.');if(!i[t])e.error('jquery.booklet: method "'+t+'" does not exist.');o=i[t].apply(i,s);if(u(o)||o){a.push(o)}});if(a.length==1){return a[0]}if(a.length>0){return a}return e(this)}return e(this).each(function(){i=e(this).data("booklet");if(i){i.destroy()}i=new w(e(this),t);return this})};e.fn.booklet.defaults={width:600,height:400,speed:500,direction:"LTR",startingIndex:0,easing:"easeInOutQuad",easeIn:"easeInQuad",easeOut:"easeOutQuad",single:false,closed:false,autoCenter:false,manual:true,hovers:true,hoverWidth:50,hoverSpeed:500,hoverThreshold:.25,hoverClick:true,overlays:false,keyboard:true,shadows:true,create:null,willchange:null,startchange:null,didchange:null,add:null,remove:null};b.prototype={constructor:b,createPageNode:function(){if(this.isBlank||this.isTransparent){return this.contentNode}else{return this.contentNode.wrap(o(t.page.default)).parent()}},destroy:function(){if(this.isBlank||this.isTransparent)this.pageNode.remove();else this.contentNode.unwrap()}};w.prototype={constructor:w}})(jQuery);