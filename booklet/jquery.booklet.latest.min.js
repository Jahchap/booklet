/*
 * jQuery Booklet Plugin
 * Copyright (c) 2010 - 2014 William Grauvogel (http://builtbywill.com/)
 *
 * Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php)
 *
 * Version : 2.0.0
 *
 */
(function(e){function s(e,t){this.index=t;this.contentNode=e;this.isTransparent=this.contentNode.hasClass("b-page-transparent");this.isBlank=this.contentNode.hasClass("b-page-blank");this.pageNode=this.createPageNode()}function o(o,u){var a=o,f=e.extend({},e.fn.booklet.defaults,u),l=false,c=false,h=false,p=false,d=false,v=false,m={page:{visibility:"hidden",zIndex:10},pageOuter:{zIndex:10},pageInner:{zIndex:30},pageVisible:{visibility:"visible",zIndex:20}},g,y=[],b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j=function(){a.addClass("booklet");a.data("booklet",this);C=a.children().length;L=0;ft();ot();ht();ut();l=true;d=false;if(f.create){a.off(r.create+i).on(r.create+i,f.create)}a.trigger(r.create,{options:e.extend({},f),index:L,pages:[y[L],y[L+1]]})},F=function(){d=false},I=function(){d=true},q=function(){wt();at();mt();a.removeClass("booklet");a.removeData("booklet");l=false},R=function(){return f.direction==n.leftToRight},U=function(){return L==0},z=function(){return L>=k-2},W=function(){return L-2>=0},X=function(){return L+2<=k-2},V=function(e){return typeof e=="string"&&e.indexOf("px")!=-1},J=function(e){return e.replace("px","")},K=function(e){return typeof e=="string"&&e.indexOf("%")!=-1},Q=function(e,t){return e.replace("%","")/100*parseFloat(t)},G=function(){return typeof M!=="undefined"&&M!=null||typeof _!=="undefined"&&_!=null},Y=function(){return f.width/2},Z=function(){return Y()/2},et=function(){return"-"+Y()+"px"},tt=function(){return"-"+Z()+"px"},nt=function(){return f.height},rt=function(){return{width:Y(),height:nt()}},it=function(){return[D,H,P,B]},st=function(){e(a.children().get().reverse()).each(function(){e(this).appendTo(a)})},ot=function(){y=[];if(f.single){a.children().each(function(n){if(!f.closed||n!=0){if(R()){e(this).before(t.page.blank)}else{e(this).after(t.page.blank)}}})}if(a.children().length%2!=0){a.children().last().after(t.page.blank)}if(f.closed){a.prepend(t.page.transparent);a.append(t.page.transparent)}k=a.children().length;if(!R()){st()}if(!l){L=R()?0:k-2;if(!isNaN(f.startingIndex)&&f.startingIndex<=k&&f.startingIndex>0){if(f.startingIndex%2!=0){f.startingIndex--}L=f.startingIndex}}a.children().each(function(t){var n=new s(e(this),t);y.push(n)})},ut=function(){ct();if(W()){b=y[L-2].pageNode;w=y[L-1].pageNode}E=y[L].pageNode;S=y[L+1].pageNode;if(X()){x=y[L+2].pageNode;T=y[L+3].pageNode}e.each(y,function(){this.pageNode.css(m.page)});if(b)b.css(m.pageOuter);if(w)w.css(m.pageInner);E.css(m.pageVisible);S.css(m.pageVisible);if(x)x.css(m.pageInner);if(T)T.css(m.pageOuter)},at=function(){e.each(y,function(){this.destroy()});y=[];ct();if(!R()){st()}},ft=function(){D=e(t.shadow.left);H=e(t.shadow.left);P=e(t.shadow.right);B=e(t.shadow.right)},lt=function(e){if(e&&D.parent()!=x||!e&&D.parent()!=E){D.css({opacity:0}).appendTo(e?x:E)}if(e&&P.parent()!=S||!e&&P.parent()!=w){P.css({opacity:0}).appendTo(e?S:w)}if(e&&H.parent()!=E||!e&&H.parent()!=b){H.css({opacity:0}).appendTo(e?E:b)}if(e&&B.parent()!=T||!e&&B.parent()!=S){B.css({opacity:0}).appendTo(e?T:S)}},ct=function(){e.each(it(),function(){this.remove()})},ht=function(t){var n=false;if(t!=null&&typeof t!="undefined"){at();f=e.extend({},f,t);n=true;ot()}pt();if(!f.autoCenter&&!f.single){mt()}else{vt();dt()}wt();bt();if(n){ut()}},pt=function(){if(!f.width){f.width=a.width()}else if(V(f.width)){f.width=J(f.width)}else if(K(f.width)){M=f.width;f.width=Q(M,a.parent().width())}if(!f.height){f.height=a.height()}else if(V(f.height)){f.height=J(f.height)}else if(K(f.height)){_=f.height;f.height=Q(_,a.parent().height())}a.width(f.width);a.height(f.height);yt()},dt=function(){if(f.closed&&f.autoCenter||f.single){if(g){g.width(f.width);g.height(f.height);if(f.single){g.width(Y());a.css({marginLeft:et()})}else if(U()){a.css({marginLeft:tt()})}else if(z()){a.css({marginLeft:Z()})}}else{a.css({marginLeft:0})}}},vt=function(){if(f.closed&&f.autoCenter||f.single){if(a.parent().hasClass("b-wrapper")){g=a.parent()}else{g=a.wrap(t.wrapper).parent()}}},mt=function(){if(a.parent().hasClass("b-wrapper")){a.unwrap();g=null}},gt=function(){if(!d){if(typeof M!=="undefined"&&M!=null){f.width=Q(M,a.parent().width());a.width(f.width)}if(typeof _!=="undefined"&&_!=null){f.height=Q(_,a.parent().height());a.height(f.height)}yt()}},yt=function(){e.each(y,function(){this.pageNode.css(rt())});e.each(it(),function(){this.css(rt())})},bt=function(){e(document).on("keyup"+i,function(e){if(e.keyCode==37&&f.keyboard){Lt()}else if(e.keyCode==39&&f.keyboard){kt()}});e(window).on("resize"+i,function(){if(G){gt()}});if(f.hovers){a.on("mousemove"+i,function(e){N=e.pageX-a.offset().left;if(f.overlays){if(N<Y()&&!U()){if(h)Nt(true);Tt(false)}else if(N>Y&&!z()){if(p)Nt(false);Tt(true)}else{Ct()}}else{if(N<f.hoverWidth){Tt(false)}else if(N>f.width-f.hoverWidth){Tt(true)}else{Ct()}}}).on("mouseleave"+i,function(){Ct()})}if(f.overlays||f.hovers){a.on("click"+i,function(e){N=e.pageX-a.offset().left;if(N<Y()&&!U()){if(f.overlays)e.preventDefault();Lt()}else if(N>Y()&&!z()){if(f.overlays)e.preventDefault();kt()}})}},wt=function(){e(document).off("keyup"+i);e(window).off("resize"+i);a.off(i)},Et=function(e){if(typeof e==="undefined"||e==null)return false;if(typeof e==="number"&&(e<0||e>C))return false;return true},St=function(t,n){if(!Et(t))return;if(typeof n==="undefined"||n==""||n==null)return;t=t=="start"?0:t=="end"?C:t;at();wt();if(t==C){a.children(":eq("+(t-1)+")").after(n)}else{a.children(":eq("+t+")").before(n)}C=a.children().length;if(f.add){a.off(r.add+i).on(r.add+i,f.add)}a.trigger(r.add,{options:e.extend({},f),index:t,page:a.children(":eq("+t+")")[0]});ot();ht();ut()},xt=function(t){if(!Et(t))return;t=t=="start"?0:t=="end"?C:t;if(a.children(".b-page").length==2&&a.find(".b-page-blank").length>0){return}at();wt();if(t>=L){if(t>0&&t%2!=0){L-=2}if(L<0){L=0}}var n;if(t==C){n=a.children(":eq("+(t-1)+")").remove()}else{n=a.children(":eq("+t+")").remove()}C=a.children().length;if(f.remove){a.off(r.remove+i).on(r.remove+i,f.remove)}a.trigger(r.remove,{options:e.extend({},f),index:t,page:n[0]});n=null;ot();ht();ut()},Tt=function(e){if(!d&&(f.hovers||f.manual)){if(e){if(!c&&!h&&!A&&X()){T.css({visibility:"visible"});S.stop().transition({rotateY:"-10deg"},f.hoverSpeed,f.easing);_t(e,f.hoverSpeed,.1);h=true}}else{if(!c&&!p&&!O&&W()){b.css({visibility:"visible"});E.stop().transition({rotateY:"10deg"},f.hoverSpeed,f.easing);_t(e,f.hoverSpeed,.1);p=true}}}},Nt=function(e){if(!d&&(f.hovers||f.manual)){if(e){if(!c&&h&&!A&&X()){T.css({visibility:"hidden"});S.stop().transition({rotateY:"0deg"},f.hoverSpeed,f.easing);_t(e,f.hoverSpeed,0);h=false}}else{if(!c&&p&&!O&&W()){b.css({visibility:"hidden"});E.stop().transition({rotateY:"0deg"},f.hoverSpeed,f.easing);_t(e,f.hoverSpeed,0);p=false}}}},Ct=function(){Nt(false);Nt(true)},kt=function(){if(!c&&!d){At(L+2)}},Lt=function(){if(!c&&!d){At(L-2)}},At=function(t){var n=f.speed;if(t<k&&t>=0&&!c&&!d){if(t>L){c=true;N=t-L;L=t;v=true}else if(t<L){c=true;N=L-t;L=t;v=false}if(f.willchange){a.off(r.willchange+i).on(r.willchange+i,f.willchange)}a.trigger(r.willchange,{options:e.extend({},f),index:t,pages:[y[t].contentNode,y[t+1].contentNode]});Ot(N,v);Mt(N,v,n);_t(v,n,1)}},Ot=function(e,t){if(t&&e>2){x.hide();T.hide();x=y[L].pageNode.css(m.pageInner).show();T=y[L+1].pageNode.css(m.pageOuter).show()}else if(!t&&e>2){b.hide();w.hide();b=y[L].pageNode.css(m.pageOuter).show();w=y[L+1].pageNode.css(m.pageInner).show()}},Mt=function(t,n,s){if(f.startchange){a.off(r.startchange+i).on(r.startchange+i,f.startchange)}a.trigger(r.startchange,{options:e.extend({},f),index:L,pages:[y[L].contentNode,y[L+1].contentNode]});if(n){T.css({visibility:"visible"});if(!f.single){if(g&&L-t==0){a.transition({marginLeft:0},s,f.easing)}else if(g&&z()){a.transition({marginLeft:Z()},s,f.easing)}}S.transition({rotateY:"-90deg"},s/2,f.easeIn,function(){S.transition({visibility:"hidden"},0);x.transition({visibility:"visible"},0).transition({rotateY:"0deg"},s/2,f.easeOut,Dt)});x.transition({rotateY:"90deg"},s/2,f.easeIn)}else{b.css({visibility:"visible"});if(!f.single){if(g&&U()){a.transition({marginLeft:tt()},s,f.easing)}else if(g&&L+t>=k-2){a.transition({marginLeft:0},s,f.easing)}}E.transition({rotateY:"90deg"},s/2,f.easeIn,function(){E.transition({visibility:"hidden"},0).transition({rotateY:"180deg"},s/2,f.easeOut);w.transition({visibility:"visible"},0).transition({rotateY:"0deg"},s/2,f.easeOut,Dt)});w.transition({rotateY:"-90deg"},s/2,f.easeIn)}},_t=function(e,t,n){if(f.shadows){lt(e);if(e){D.css({opacity:n});B.css({opacity:n});B.stop().animate({opacity:0},t,f.easing);P.stop().animate({opacity:n},t/2,f.easeIn,function(){D.stop().animate({opacity:0},t/2,f.easeOut)});H.stop().animate({opacity:n},t,f.easing,function(){if(n==0){ct()}})}else{P.css({opacity:n});H.css({opacity:n});H.animate({opacity:0},t,f.easeIn);D.stop().animate({opacity:n},t/2,f.easeIn,function(){P.stop().animate({opacity:0},t/2,f.easeOut)});B.stop().animate({opacity:n},t,f.easing,function(){if(n==0){ct()}})}}},Dt=function(){ut();c=false;if(f.didchange){a.off(r.didchange+i).on(r.didchange+i,f.didchange)}a.trigger(r.didchange,{options:e.extend({},f),index:L,pages:[y[L].contentNode,y[L+1].contentNode]})};return{init:j,enable:F,disable:I,destroy:q,next:kt,prev:Lt,gotopage:function(e){if(typeof e==="string"){if(e=="start"){e=0}else if(e=="end"){e=k-2}else{this.gotopage(parseInt(e))}}else if(typeof e==="number"){if(e<0||e>=k){return}}else if(typeof e==="undefined"){return}if(e%2!=0){e-=1}if(!R()){e=Math.abs(e-k)-2}At(e)},add:St,remove:xt,option:function(t,n){if(typeof t==="string"){if(typeof f[t]==="undefined")e.error('Option "'+t+'" does not exist on jQuery.booklet.');if(typeof n!=="undefined"){f[t]=n;ht();return}return f[t]}if(typeof t==="object"){ht(t);return}if(typeof t==="undefined"){return e.extend({},f)}}}}var t={page:{blank:'<div class="b-page b-page-blank"></div>',transparent:'<div class="b-page b-page-transparent"></div>',cover:'<div class="b-page b-page-cover"></div>',"default":'<div class="b-page"></div>'},shadow:{left:'<div class="b-shadow-left"></div>',right:'<div class="b-shadow-right"></div>'},pageNumber:'<div class="b-counter"></div>',wrapper:'<div class="b-wrapper"></div>'},n={leftToRight:"LTR",rightToLeft:"RTL"},r={create:"bookletcreate",willchange:"bookletwillchange",startchange:"bookletstartchange",didchange:"bookletdidchange",add:"bookletadd",remove:"bookletremove"},i=".booklet";e.fn.booklet=function(t,n,r){var i,s,u,a;if(typeof t==="string"){a=[];s=[];if(typeof n!=="undefined"){s.push(n)}if(typeof r!=="undefined"){s.push(r)}e(this).each(function(){i=e(this).data("booklet");if(!i)e.error('jQuery.booklet has not been initialized. Method "'+t+'" cannot be called.');if(!i[t])e.error('Method "'+t+'" does not exist on jQuery.booklet.');u=i[t].apply(i,s);if(typeof u!=="undefined"||u){a.push(u)}});if(a.length==1){return a[0]}if(a.length>0){return a}return e(this)}return e(this).each(function(){i=e(this).data("booklet");if(i){i.destroy()}i=new o(e(this),t);i.init();return this})};e.fn.booklet.defaults={width:600,height:400,speed:500,direction:"LTR",startingIndex:0,easing:"easeInOutQuad",easeIn:"easeInQuad",easeOut:"easeOutQuad",single:false,closed:false,autoCenter:false,manual:true,hovers:true,hoverWidth:50,hoverSpeed:500,hoverThreshold:.25,hoverClick:true,overlays:false,keyboard:true,shadows:true,create:null,willchange:null,startchange:null,didchange:null,add:null,remove:null};s.prototype={constructor:s,createPageNode:function(){if(this.isBlank||this.isTransparent){return this.contentNode}else{return this.contentNode.wrap(t.page.default).parent()}},destroy:function(){if(this.isBlank||this.isTransparent)this.pageNode.remove();else this.contentNode.unwrap()}}})(jQuery)